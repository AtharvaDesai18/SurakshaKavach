{% extends 'layout.html' %}

{% block title %}Password Health Suite{% endblock %}

{% block content %}
<div class="intel-header">
    <h1><i class="fas fa-key"></i> Password Health Suite</h1>
    <p class="subtitle">Tools to create and evaluate strong, secure passwords</p>
</div>

<div class="content-grid">
    <!-- Password Strength Checker -->
    <div class="chart-container">
        <div class="chart-header">
            <h2><i class="fas fa-tasks"></i> Strength Checker</h2>
        </div>
        <div class="input-group">
            <i class="fas fa-lock"></i>
            <input type="text" id="password-input" placeholder="Type a password to check its strength...">
        </div>
        <div class="strength-meter">
            <div class="strength-bar"></div>
        </div>
        <p class="strength-text">Enter a password to see its strength.</p>
    </div>

    <!-- Secure Password Generator -->
    <div class="alerts-container">
        <div class="alerts-header">
            <h2><i class="fas fa-magic"></i> Secure Generator</h2>
        </div>
        <div class="generated-password-container">
            <input type="text" id="generated-password" readonly placeholder="Your new password will appear here...">
            <button id="copy-btn" class="btn-action"><i class="fas fa-copy"></i> Copy</button>
        </div>
        <div class="generator-options">
            <div class="option">
                <label for="length">Password Length:</label>
                <span id="length-value">16</span>
                <input type="range" id="length" min="8" max="32" value="16">
            </div>
            <div class="option">
                <label for="include-uppercase">Include Uppercase</label>
                <input type="checkbox" id="include-uppercase" checked>
            </div>
            <div class="option">
                <label for="include-numbers">Include Numbers</label>
                <input type="checkbox" id="include-numbers" checked>
            </div>
            <div class="option">
                <label for="include-symbols">Include Symbols</label>
                <input type="checkbox" id="include-symbols" checked>
            </div>
        </div>
        <button id="generate-btn" class="btn-search" style="width: 100%; justify-content: center; margin-top: 1rem;">
            <i class="fas fa-sync-alt"></i> Generate New Password
        </button>
    </div>
</div>

<style>
    .strength-meter {
        height: 10px;
        width: 100%;
        background-color: rgba(255, 255, 255, 0.1);
        border-radius: 5px;
        margin-top: 1rem;
        overflow: hidden;
    }
    .strength-bar {
        height: 100%;
        width: 0;
        background-color: var(--danger);
        transition: width 0.3s ease, background-color 0.3s ease;
    }
    .strength-text {
        margin-top: 0.5rem;
        text-align: center;
        color: var(--gray);
        font-size: 0.9em;
    }
    .generated-password-container {
        display: flex;
        gap: 10px;
        margin-bottom: 1.5rem;
    }
    #generated-password {
        flex-grow: 1;
        background-color: var(--darkest);
        border: 1px solid var(--dark);
        border-radius: 0.5rem;
        padding: 0.75rem;
        color: var(--light);
        font-size: 1.1em;
        text-align: center;
    }
    .generator-options {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }
    .option {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .option input[type="range"] {
        flex-grow: 1;
        margin: 0 1rem;
    }
</style>

<script>
    const passwordInput = document.getElementById('password-input');
    const strengthBar = document.querySelector('.strength-bar');
    const strengthText = document.querySelector('.strength-text');

    const lengthEl = document.getElementById('length');
    const lengthValueEl = document.getElementById('length-value');
    const uppercaseEl = document.getElementById('include-uppercase');
    const numbersEl = document.getElementById('include-numbers');
    const symbolsEl = document.getElementById('include-symbols');
    const generateBtn = document.getElementById('generate-btn');
    const generatedPasswordEl = document.getElementById('generated-password');
    const copyBtn = document.getElementById('copy-btn');

    passwordInput.addEventListener('input', () => {
        const password = passwordInput.value;
        const strength = calculateStrength(password);
        updateStrengthUI(strength);
    });

    lengthEl.addEventListener('input', () => {
        lengthValueEl.innerText = lengthEl.value;
    });

    generateBtn.addEventListener('click', generatePassword);
    
    copyBtn.addEventListener('click', () => {
        if(generatedPasswordEl.value) {
            navigator.clipboard.writeText(generatedPasswordEl.value);
            copyBtn.innerHTML = '<i class="fas fa-check"></i> Copied!';
            setTimeout(() => {
                copyBtn.innerHTML = '<i class="fas fa-copy"></i> Copy';
            }, 2000);
        }
    });

    function calculateStrength(password) {
        let score = 0;
        if (!password) return 0;

        // Award points for different criteria
        if (password.length >= 8) score++;
        if (password.length >= 12) score++;
        if (/[A-Z]/.test(password)) score++;
        if (/[0-9]/.test(password)) score++;
        if (/[^A-Za-z0-9]/.test(password)) score++;

        return score;
    }

    function updateStrengthUI(score) {
        const levels = {
            0: { width: '0%', color: 'var(--danger)', text: 'Enter a password to see its strength.' },
            1: { width: '20%', color: 'var(--danger)', text: 'Very Weak' },
            2: { width: '40%', color: 'var(--danger)', text: 'Weak' },
            3: { width: '60%', color: 'var(--warning)', text: 'Medium' },
            4: { width: '80%', color: 'var(--success)', text: 'Strong' },
            5: { width: '100%', color: 'var(--success)', text: 'Very Strong' }
        };
        const { width, color, text } = levels[score];
        strengthBar.style.width = width;
        strengthBar.style.backgroundColor = color;
        strengthText.innerText = text;
    }

    function generatePassword() {
        const length = +lengthEl.value;
        const hasUpper = uppercaseEl.checked;
        const hasNumber = numbersEl.checked;
        const hasSymbol = symbolsEl.checked;

        let charset = 'abcdefghijklmnopqrstuvwxyz';
        if (hasUpper) charset += 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
        if (hasNumber) charset += '0123456789';
        if (hasSymbol) charset += '!@#$%^&*()_+[]{}|;:,.<>?';
        
        if (charset.length === 0) {
            generatedPasswordEl.value = 'Select at least one option';
            return;
        }

        let password = '';
        for (let i = 0; i < length; i++) {
            password += charset.charAt(Math.floor(Math.random() * charset.length));
        }
        generatedPasswordEl.value = password;
    }
    
    // Generate an initial password on page load
    generatePassword();
</script>
{% endblock %}
